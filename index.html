<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="music.css">
</head>
<body>
  <h1>CÃ” CHI NGHE NHAC NHA</h1>
    <div class="player">
        <!-- Dashboard -->
        <div class="dashboard">
          <!-- Header -->
          <header>
            <h4>Now playing:</h4>
            <h2>String 57th & 9th</h2>
          </header>
      
          <!-- CD -->
          <div class="cd">
            <div class="cd-thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
            </div>
          </div>
      
          <!-- Control -->
          <div class="control">
            <div class="btn btn-repeat">
              <i class="fas fa-redo"></i>
            </div>
            <div class="btn btn-prev">
              <i class="fas fa-step-backward"></i>
            </div>
            <div class="btn btn-toggle-play">
              <i class="fas fa-pause icon-pause"></i>
              <i class="fas fa-play icon-play"></i>
            </div>
            <div class="btn btn-next">
              <i class="fas fa-step-forward"></i>
            </div>
            <div class="btn btn-random">
              <i class="fas fa-random"></i>
            </div>
          </div>
      
          <input id="progress" class="progress" type="range" value="0" step="1" min="0" max="100">
      
          <audio id="audio" src=""></audio>
        </div>
      
        <!-- Playlist -->
        <div class="playlist">
          <!-- 
            <div class="song">
            <div class="thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
            </div>
            <div class="body">
              <h3 class="title">Music name</h3>
              <p class="author">Singer</p>
            </div>
            <div class="option">
              <i class="fas fa-ellipsis-h"></i>
            </div>
          </div> -->

        </div>
      </div>
      <script>
          const $=document.querySelector.bind(document);
          const $$=document.querySelectorAll.bind(document);
          const playlist=$(".playlist");
          const header=$("header h2");
           const cdThumb=$(".cd-thumb");
           const audio=$("#audio");
           const togglePlay=$(".btn-toggle-play");
           const playing=$(".player");
           const progress=$(".progress")
            const isupdatetime=true;
            const nextsong=$(".btn-next")
            const prevsong=$(".btn-prev");
            const random=$(".btn-random");
            const repeat=$(".btn-repeat");
           
          
          const app = {
            isrepeat:false,
            isramdom:false,
            isplaying:false,
            currentIndex:0,
            songs:[
                {
                name:'AnhThuongEmConNonDai',
                singer:'Dinh Dung',
                path:'music/AnhThuongEmConNonDai-DinhDung.mp3',
                image:'img/music1.jpg'
            },
            {
                name:'AnhKhongThaThu',
                singer:'Dinh Dung',
                path:'music/AnhKhongThaThu-DinhDung.mp3',
                image:'img/music2.jpg'
            },
            {
                name:'CauHenCauThe',
                singer:'Dinh Dung',
                path:'music/CauHenCauThe-DinhDung.mp3',
                image:'img/music3.jpg'
            },
            {
                name:'HoaNoKhongMau',
                singer:'Thai Khang',
                path:'music/HoaNoKhongMau-HoaiLam.mp3',
                image:'img/music4.jpg'
            },
            {
                name:'NangTho',
                singer:'Thuan Le',
                path:'music/NangTho-HoangDung.mp3',
                image:'img/music5.jpg'
            },
            {
                name:'NiuDuyen',
                singer:'Khang Pham',
                path:'music/NiuDuyen-LeBaoBinh.mp3',
                image:'img/music6.jpg'
            },
            {
                name:'PhaiChangEmDaYeu',
                singer:'Pham Khang',
                path:'music/PhaiChangEmDaYeu-JukySanRedT.mp3',
                image:'img/music7.jpg'
            }],
            render:function(){
                const htmls=this.songs.map(song => {
                return `
                <div class="song">
                    <div class="thumb" style="background-image: url('${song.image}')">
                    </div>
                    <div class="body">
                    <h3 class="title">${song.name}</h3>
                    <p class="author">${song.singer}</p>
                    </div>
                    <div class="option">
                    <i class="fas fa-ellipsis-h"></i>
                    </div>
                </div> `            
            })
            $(".playlist").innerHTML=htmls.join(" ");
          },
          defineProperties:function(){
            Object.defineProperty(this,'currentSong',{
            get : function(){
              return this.songs[this.currentIndex];
            }})
          },
          handleEvent:function(){
            const cd=$(".cd");
            const cdWidth=cd.offsetWidth;
            const iscdThumb=cdThumb.animate([
              {transform:'rotate(360deg)'},
            ],{duration:10000,
              iterations:Infinity
            })
            iscdThumb.pause();
            document.onscroll=function(){
              const scrollTop=parseInt(document.documentElement.scrollTop);
              
              const newcdWidth=cdWidth-scrollTop;
              cd.style.width=newcdWidth>0?newcdWidth+"px":0;
              cd.style.opacity=newcdWidth/cdWidth;
            }
            console.log(iscdThumb);
            togglePlay.onclick=function(){
              if(app.isplaying){
                app.isplaying=false;
                audio.pause();
                playing.classList.remove("playing");
                iscdThumb.pause();
              }else{
                app.isplaying=true;
                audio.play();
                playing.classList.add("playing");
                iscdThumb.play();
              }
            } 
          nextsong.onclick=function(){
            app.nextSong();
            app.isplaying=true;
             audio.play();
             playing.classList.add("playing");
            iscdThumb.play();
          }
          prevsong.onclick=function(){
            app.nextSong();
            app.isplaying=true;
             audio.play();
             playing.classList.add("playing");
            iscdThumb.play();
          }
          random.onclick=function(){
            if(app.isramdom){
              random.classList.remove("active");
              app.isramdom=false;
            } else{
              random.classList.add("active");
              repeat.classList.remove("active");
              app.isramdom=true;
              app.isrepeat=false;
            }          
            
          }
          repeat.onclick=function(){
            if(app.isrepeat){
              repeat.classList.remove("active");
              app.isrepeat=false;
            } else{
              repeat.classList.add("active");
              random.classList.remove("active");
              app.isrepeat=true;     
              app.isramdom=false;
            }          
            
          }
          audio.onended=function(){
            console.log("123");
            if(app.isramdom==true){
              app.ramdomsong();
              audio.play();
            }
            if(app.isrepeat){
              app.repreatsong();
              audio.play();
            }
          }
          audio.ontimeupdate=function(){
            if( isupdatetime){
              if(audio.duration){
                const progresspPercent = (Math.floor(audio.currentTime/audio.duration*100));
                progress.value=progresspPercent;
              }          
            }
          }
          progress.onClick=function(){
            isupdatetime=false;       
          }
          progress.onchange=function(){
            const seektinme=audio.duration*progress.value/100;
            audio.currentTime=seektinme;
            isupdatetime=true;
          } 
          },
          loadCurrentSong:function(){
          var allsong=$$(".song");
          header.textContent=this.currentSong.name;
          cdThumb.style.backgroundImage=`url(${this.currentSong.image})`;
          audio.src=this.currentSong.path;
          allsong.forEach(function(song){
              if(song.querySelector(".title").innerHTML==app.currentSong.name){
                 song.classList.add("active")
              }
              else{
                song.classList.remove("active");
              }
          });

          },
          ramdomsong:function(){
            var numberrd=0;
            do{
              numberrd = Math.floor(Math.random()*app.songs.length-1)+1;
              
            }while(numberrd==app.currentIndex);
            app.currentIndex=numberrd;
            app.loadCurrentSong();
          },
          repreatsong:function(){
            app.currentIndex=app.currentIndex;
            app.loadCurrentSong();
          },
          nextSong:function(){
            app.currentIndex++;
            if(app.currentIndex >= app.songs.length){
              app.currentIndex=0;
            }
            app.loadCurrentSong();
          },
          prevSong:function(){
            app.currentIndex--;
            if(app.currentIndex <= app.songs.length){
              app.currentIndex=app.songs.length-1;
            }
            app.loadCurrentSong();
          },
             start:function(){
              this.render();
               this.defineProperties();
               this.handleEvent();
               this.loadCurrentSong();
                
             }

          }
          app.start();
      </script>
</body>
</html>